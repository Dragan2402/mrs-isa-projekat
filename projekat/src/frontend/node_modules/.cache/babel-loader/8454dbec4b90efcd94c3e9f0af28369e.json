{"ast":null,"code":"import axios from \"axios\";\nexport default {\n  name: \"RentingEntityPreview\",\n\n  data() {\n    let takenDatesPoppers = [];\n    return {\n      id: 0,\n      displayType: 0,\n      rentingEntity: {},\n      selectedOffer: {},\n      selected: false,\n      date: null,\n      pictures: [],\n      isSubscribed: false,\n      index: 0,\n      offers: [],\n      additionalServices: [],\n      selectedServices: [],\n      loaded: false,\n      loadedCalendar: false,\n      takenDates: [],\n      range: {\n        start: null,\n        end: null\n      },\n      incId: takenDatesPoppers.length,\n      takenDatesPoppers,\n      bars: []\n    };\n  },\n\n  mounted() {\n    this.minDate = null;\n    this.maxDate = null;\n    this.displayType = this.$route.params.displayType;\n    this.id = this.$route.params.id;\n    this.loaded = false;\n    let path, pathOffers, pathPictures;\n\n    if (this.displayType == 0 && this.id != undefined) {\n      path = \"/api/vacationHouses/anyUser/\" + this.id;\n      pathOffers = \"/api/vacationHouses/anyUser/\" + this.id + \"/offers\";\n      pathPictures = \"/api/vacationHouses/anyUser/\" + this.id + \"/pictures/all\";\n    } else if (this.displayType == 1 && this.id != undefined) {\n      path = \"/api/ships/anyUser/\" + this.id;\n      pathOffers = \"/api/ships/anyUser/\" + this.id + \"/offers\";\n      pathPictures = \"/api/ships/anyUser/\" + this.id + \"/pictures/all\";\n    } else if (this.id != undefined) {\n      path = \"/api/fishingClasses/anyUser/\" + this.id;\n      pathOffers = \"/api/fishingClasses/anyUser/\" + this.id + \"/offers\";\n      pathPictures = \"/api/fishingClasses/anyUser/\" + this.id + \"/pictures/all\";\n    }\n\n    axios.get(path).then(response => {\n      this.rentingEntity = response.data;\n      this.loaded = true;\n    });\n    axios.get(pathPictures).then(response => {\n      for (let i = 0; i < response.data.length; i++) {\n        this.pictures.push(response.data[i]);\n      }\n    });\n    axios.get(pathOffers).then(response => this.offers = response.data);\n\n    if (localStorage.getItem(\"jwt\") != \"null\") {\n      if (this.$root.loggedUser.accountType == \"CLIENT\") {\n        const path = \"/api/clients/isSubscribed/\" + this.id;\n        axios.get(path, {\n          headers: {\n            \"Authorization\": `Bearer ${localStorage.getItem(\"jwt\")}`\n          }\n        }).then(response => {\n          this.isSubscribed = response.data;\n        });\n      }\n    }\n  },\n\n  computed: {\n    attributes() {\n      return [...this.bars, // Attributes for todos\n      ...this.takenDatesPoppers.map(todo => ({\n        dates: todo.dates,\n        dot: {\n          color: todo.color,\n          class: todo.isComplete ? 'opacity-75' : ''\n        },\n        popover: {\n          label: todo.description\n        },\n        customData: todo\n      }))];\n    }\n\n  },\n  methods: {\n    msToTime(duration) {\n      var minutes = Math.floor(duration / (1000 * 60) % 60),\n          hours = Math.floor(duration / (1000 * 60 * 60) % 24);\n\n      if (minutes > 0) {\n        return hours + \"H\" + \" \" + minutes;\n      } else {\n        return hours + \"H\";\n      }\n    },\n\n    dateFromLocal(dateString) {\n      if (dateString == null) {\n        return new Date();\n      }\n\n      const parts = dateString.split(\" \");\n\n      if (parts.length != 2) {\n        return new Date();\n      }\n\n      const dateParts = parts[0].split(\".\");\n\n      if (dateParts.length != 3) {\n        return new Date();\n      }\n\n      const hourParts = parts[1].split(\":\");\n\n      if (hourParts.length != 2) {\n        return new Date();\n      }\n\n      const day = dateParts[0];\n      const month = dateParts[1];\n      const year = dateParts[2];\n      const hours = hourParts[0];\n      const minutes = hourParts[1]; // new Date(year, month, day, hours, minutes, seconds, milliseconds)\n\n      const date = new Date(year, month - 1, day, hours, minutes);\n      return date;\n    },\n\n    subscribe() {\n      if (localStorage.getItem(\"jwt\") == \"null\") {\n        this.$router.push(\"/loginPage\");\n        return;\n      }\n\n      if (this.$root.loggedUser.accountType != \"CLIENT\") {\n        this.$toast.error(\"Only available for clients\");\n        return;\n      }\n\n      axios.put(`/api/clients/subscribe`, this.rentingEntity, {\n        headers: {\n          \"Authorization\": `Bearer ${localStorage.getItem(\"jwt\")}`\n        }\n      }).then(response => {\n        if (response.data == true) {\n          this.$toast.success(\"Subscribed\");\n          this.isSubscribed = true;\n        } else {\n          this.$toast.error(\"Error\");\n          this.isSubscribed = false;\n        }\n      });\n    },\n\n    unSubscribe() {\n      if (localStorage.getItem(\"jwt\") == \"null\") {\n        this.$router.push(\"/loginPage\");\n        return;\n      }\n\n      if (this.$root.loggedUser.accountType != \"CLIENT\") {\n        this.$toast.error(\"Only available for clients\");\n        return;\n      }\n\n      axios.put(`/api/clients/unSubscribe`, this.rentingEntity, {\n        headers: {\n          \"Authorization\": `Bearer ${localStorage.getItem(\"jwt\")}`\n        }\n      }).then(response => {\n        if (response.data == true) {\n          this.$toast.success(\"Unsubscribed\");\n          this.isSubscribed = false;\n        } else {\n          this.$toast.error(\"Error\");\n          this.isSubscribed = true;\n        }\n      });\n    },\n\n    generateBar(takenDTO) {\n      let color = \"red\";\n\n      if (takenDTO.type == \"Offer\") {\n        color = \"blue\";\n      }\n\n      let datesBars = [];\n      let takenTo = this.dateFromLocal(takenDTO.takenTo);\n\n      for (var d = this.dateFromLocal(takenDTO.takenFrom); d <= takenTo; d.setDate(d.getDate() + 1)) {\n        const date = new Date(d);\n        datesBars.push(date);\n      }\n\n      const bar = {\n        dates: datesBars,\n        bar: color\n      };\n      this.bars.push(bar);\n    },\n\n    generatePopover(takenDTO) {\n      let color = \"red\";\n\n      if (takenDTO.type == \"Offer\") {\n        color = \"blue\";\n      }\n\n      const takenStart = {\n        description: takenDTO.startsAt,\n        isComplete: false,\n        dates: this.dateFromLocal(takenDTO.takenFrom),\n        // Every Friday\n        color: color\n      };\n      const takenEnd = {\n        description: takenDTO.endsAt,\n        isComplete: false,\n        dates: this.dateFromLocal(takenDTO.takenTo),\n        color: color\n      };\n      this.takenDatesPoppers.push(takenStart);\n      this.takenDatesPoppers.push(takenEnd);\n    },\n\n    takeCalendar(takenDates) {\n      this.bars = [];\n      this.takenDatesPoppers = [];\n      takenDates.forEach(this.generateBar);\n      takenDates.forEach(this.generatePopover);\n      this.takenDates = takenDates;\n    },\n\n    toggleMakingReservation() {\n      if (localStorage.getItem(\"jwt\") == \"null\") {\n        this.$router.push(\"/loginPage\");\n        return;\n      }\n\n      if (this.$root.loggedUser.accountType != \"CLIENT\") {\n        this.$toast.error(\"Only available for clients\");\n        return;\n      }\n\n      axios.get(`/api/clients/rentingEntityAvailability/${this.rentingEntity.id}`, {\n        headers: {\n          \"Authorization\": `Bearer ${localStorage.getItem(\"jwt\")}`\n        }\n      }).then(response => {\n        this.takeCalendar(response.data);\n        const availableFromDate = this.dateFromLocal(this.rentingEntity.availableFrom);\n        const availableToDate = this.dateFromLocal(this.rentingEntity.availableTo);\n        const now = new Date();\n        console.log(availableFromDate);\n        console.log(availableToDate);\n\n        if (availableFromDate <= now) {\n          this.minDate = now;\n        } else {\n          this.minDate = availableFromDate;\n        }\n\n        if (availableToDate <= now) {\n          this.maxDate = now;\n        } else {\n          this.maxDate = availableToDate;\n        }\n\n        let availableFrom = \"Renting entity available from \" + this.minDate.getHours() + \":\" + this.minDate.getMinutes();\n        let availableTo = \"Renting entity available till \" + this.maxDate.getHours() + \":\" + this.maxDate.getMinutes();\n\n        if (availableToDate < now && availableFromDate < now) {\n          this.$toast.error(\"Entity is not available currently\");\n          availableFrom = \"Not available\";\n          availableTo = \"Not available\";\n        }\n\n        const takenStart = {\n          description: availableFrom,\n          isComplete: false,\n          dates: this.minDate,\n          color: \"green\"\n        };\n        const takenEnd = {\n          description: availableTo,\n          isComplete: false,\n          dates: this.maxDate,\n          color: \"green\"\n        };\n        this.takenDatesPoppers.push(takenStart);\n        this.takenDatesPoppers.push(takenEnd);\n        this.loadedCalendar = true;\n      });\n      let servicesPath;\n\n      if (this.displayType == 0) {\n        servicesPath = \"/api/vacationHouseOwners/getServices/\" + this.rentingEntity.ownerId;\n      } else if (this.displayType == 1) {\n        servicesPath = \"/api/shipOwners/getServices/\" + this.rentingEntity.ownerId;\n      } else {\n        servicesPath = \"/api/fishingInstructors/getServices/\" + this.rentingEntity.ownerId;\n      }\n\n      axios.get(servicesPath, {\n        headers: {\n          \"Authorization\": `Bearer ${localStorage.getItem(\"jwt\")}`\n        }\n      }).then(response => this.additionalServices = response.data);\n    },\n\n    freeSlot(start, end) {\n      for (let i = 0; i < this.takenDates.length; i++) {\n        const takenFrom = this.dateFromLocal(this.takenDates[i].takenFrom);\n        const takenTo = this.dateFromLocal(this.takenDates[i].takenTo);\n\n        if (start >= takenFrom && end <= takenTo || start <= takenFrom && end >= takenTo || start >= takenFrom && start <= takenTo || end <= takenTo && end >= takenFrom || start < this.minDate || end > this.maxDate) {\n          return false;\n        }\n      }\n\n      return true;\n    },\n\n    confirmReservation() {\n      const start = this.range.start;\n      const end = this.range.end;\n\n      if (this.freeSlot(start, end)) {\n        let clientLimit = 0;\n\n        if (this.displayType == 0) {\n          clientLimit = this.rentingEntity.roomsQuantity * this.rentingEntity.bedsPerRoom;\n        } else {\n          clientLimit = this.rentingEntity.clientLimit;\n        }\n\n        if (this.$root.loggedUser.penalties == 3) {\n          this.$toast.error(\"You can not make a reservation. You have 3 penalties. Wait for next month.\");\n          return;\n        }\n\n        if (this.minDate == this.maxDate) {\n          return;\n        }\n\n        const reservation = {\n          \"place\": this.rentingEntity.address,\n          \"clientLimit\": clientLimit,\n          \"additionalServices\": this.selectedServices,\n          \"price\": this.rentingEntity.priceList,\n          \"rentingEntityId\": this.rentingEntity.id,\n          \"start\": start,\n          \"end\": end\n        };\n        axios.post(`/api/clients/makeReservationFull`, reservation, {\n          headers: {\n            \"Authorization\": `Bearer ${localStorage.getItem(\"jwt\")}`\n          }\n        }).then(response => {\n          if (response.data == true) {\n            this.$toast.success(\"Reservation made\");\n          } else {\n            if (response.status == 423) {\n              this.$toast.error(\"Try later.\");\n            } else {\n              this.$toast.error(\"Error\");\n            }\n          }\n        });\n      } else {\n        this.$toast.error(\"Select free date\");\n      }\n    },\n\n    makeReservation(offer, index) {\n      if (localStorage.getItem(\"jwt\") == \"null\") {\n        this.$router.push(\"/loginPage\");\n        return;\n      }\n\n      if (this.$root.loggedUser.accountType != \"CLIENT\") {\n        this.$toast.error(\"Only available for clients\");\n        return;\n      }\n\n      if (this.$root.loggedUser.penalties == 3) {\n        this.$toast.error(\"You can not make a reservation. You have 3 penalties. Wait for next month.\");\n        return;\n      }\n\n      axios.post(`/api/offers/makeQuickReservation`, offer, {\n        headers: {\n          \"Authorization\": `Bearer ${localStorage.getItem(\"jwt\")}`\n        }\n      }).then(response => {\n        if (response.data == true) {\n          this.$toast.success(\"Reservation made\");\n          this.offers.splice(index, 1);\n        } else {\n          this.$toast.error(\"You can not make a reservation. You have 3 penalties. Wait for next month.\");\n        }\n      });\n    },\n\n    updateRating() {\n      this.rating = 4.1;\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["axios","name","data","takenDatesPoppers","id","displayType","rentingEntity","selectedOffer","selected","date","pictures","isSubscribed","index","offers","additionalServices","selectedServices","loaded","loadedCalendar","takenDates","range","start","end","incId","length","bars","mounted","minDate","maxDate","$route","params","path","pathOffers","pathPictures","undefined","get","then","response","i","push","localStorage","getItem","$root","loggedUser","accountType","headers","computed","attributes","map","todo","dates","dot","color","class","isComplete","popover","label","description","customData","methods","msToTime","duration","minutes","Math","floor","hours","dateFromLocal","dateString","Date","parts","split","dateParts","hourParts","day","month","year","subscribe","$router","$toast","error","put","success","unSubscribe","generateBar","takenDTO","type","datesBars","takenTo","d","takenFrom","setDate","getDate","bar","generatePopover","takenStart","startsAt","takenEnd","endsAt","takeCalendar","forEach","toggleMakingReservation","availableFromDate","availableFrom","availableToDate","availableTo","now","console","log","getHours","getMinutes","servicesPath","ownerId","freeSlot","confirmReservation","clientLimit","roomsQuantity","bedsPerRoom","penalties","reservation","address","priceList","post","status","makeReservation","offer","splice","updateRating","rating"],"sourceRoot":"","sources":["C:\\Users\\draga\\OneDrive\\Dokumenti\\MRS-ISA-PROJEKAT\\mrs-isa-projekat\\projekat\\src\\frontend\\src\\components\\RentingEntityPreview.vue"],"sourcesContent":["<template>\r\n  <div class=\"main-container\" v-if=\"loaded\">\r\n    <div class=\"heading-flex\">\r\n      <div class=\"heading-left\">\r\n        <h3 class=\"main-heading\">{{rentingEntity.name}}</h3>\r\n        <vue3-star-ratings v-if=\"loaded\" class=\"star-ratings\"  v-model=\"rentingEntity.rating\" starSize=\"22\"  :showControl=false :disableClick=true :step=0 />\r\n        <h5 class=\"star-heading\">({{rentingEntity.reviewsNumber}})</h5>\r\n      </div>\r\n      <div class=\"heading-right\">\r\n        <div class=\"heading-right-buttons\">\r\n          <button style=\"margin-right: 20px\" class=\"custom-btn button-primary\" v-if=\"!isSubscribed\" @click=\"subscribe()\">Subscribe</button>\r\n          <button style=\"margin-right: 20px\" class=\"custom-btn button-primary\" v-else @click=\"unSubscribe()\">Unsubscribe</button>\r\n          <button type=\"button\" @click=\"toggleMakingReservation\" class=\"custom-btn button-primary\" data-bs-toggle=\"modal\" data-bs-target=\"#modalReservation\">Custom reservation</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div id=\"carouselExampleControls\" class=\"carousel slide\" data-bs-ride=\"carousel\">\r\n      <div class=\"carousel-inner\">\r\n        <div class=\"carousel-item active\">\r\n          <img class=\"carousel-image d-block w-100\" alt=\"Active picture\" v-bind:src=\"'data:image/jpeg;base64,' + pictures.at(0)\">\r\n        </div>\r\n        <div class=\"carousel-item\" v-for=\"(picture, index) in pictures.slice(1)\" :key=\"index\">\r\n          <img class=\"carousel-image d-block w-100\" alt=\"Item picture\" v-bind:src=\"'data:image/jpeg;base64,' + picture\">\r\n        </div>\r\n      </div>\r\n      <button class=\"carousel-control-prev\" type=\"button\" data-bs-target=\"#carouselExampleControls\" data-bs-slide=\"prev\">\r\n        <span class=\"carousel-control-prev-icon\" aria-hidden=\"true\"></span>\r\n        <span class=\"visually-hidden\">Previous</span>\r\n      </button>\r\n      <button class=\"carousel-control-next\" type=\"button\" data-bs-target=\"#carouselExampleControls\" data-bs-slide=\"next\">\r\n        <span class=\"carousel-control-next-icon\" aria-hidden=\"true\"></span>\r\n        <span class=\"visually-hidden\">Next</span>\r\n      </button>\r\n    </div>\r\n    <div class=\"main-description\">\r\n      <div class=\"inner-description\">\r\n        <div><b>Address: </b> {{rentingEntity.address}}</div>\r\n        <div><b>Description: </b> {{rentingEntity.promoDescription}}</div>\r\n        <div><b>Behaviour rules: </b> {{rentingEntity.behaviourRules}}</div>\r\n        <div><b>Price: </b> {{rentingEntity.priceList}}&euro;</div>\r\n        <div><b>Additional info: </b>{{rentingEntity.additionalInfo}}</div>\r\n        <div><b>Cancellation conditions: </b>{{rentingEntity.cancellationConditions}}</div>\r\n        <div v-if=\"this.displayType==0\"><b>Capacity: </b>{{rentingEntity.roomsQuantity}} rooms, {{rentingEntity.bedsPerRoom}} beds per room</div>\r\n        <div v-if=\"this.displayType==1\"><b>Type: </b>{{rentingEntity.type}}</div>\r\n        <div v-if=\"this.displayType==1\"><b>Length: </b>{{rentingEntity.length}}</div>\r\n        <div v-if=\"this.displayType==1\"><b>Engine Number: </b>{{rentingEntity.engineNumber}}</div>\r\n        <div v-if=\"this.displayType==1\"><b>Engine Power: </b>{{rentingEntity.enginePower}}</div>\r\n        <div v-if=\"this.displayType==1\"><b>Top Speed: </b>{{rentingEntity.topSpeed}}</div>\r\n        <div v-if=\"this.displayType==1\"><b>Client Limit: </b>{{rentingEntity.clientLimit}}</div>\r\n        <div v-if=\"this.displayType==2\"><b>Instructor biography: </b>{{rentingEntity.instructorBiography}}</div>\r\n        <div v-if=\"this.displayType==2\"><b>Client limit: </b>{{rentingEntity.clientLimit}}</div>\r\n      </div>\r\n      <div class=\"google-map-container\">\r\n        <iframe class=\"google-map\" v-bind:src=\"'https://maps.google.com/maps?q=' + rentingEntity.address + '&t=&z=13&ie=UTF8&iwloc=&output=embed'\"></iframe>\r\n      </div>\r\n    </div>\r\n    <hr>\r\n    <div class=\"main-offer-container\">\r\n      <h4 v-if=\"this.offers.length !== 0\">Offers:</h4>\r\n      <div class=\"inner-offer-container\">\r\n        <div class=\"offer\" v-for=\"(offer, index) in this.offers\" v-bind:index=\"index\" :key=\"offer.id\">\r\n          <div class=\"offer-description\">\r\n            <div class=\"offer-left\">\r\n              <div><b>Address: </b> {{offer.place}}</div>\r\n              <div><b>Price: </b> {{offer.price}}</div>\r\n              <div><b>Client limit: </b>{{offer.clientLimit}}</div>\r\n              <div><b>Starting at: </b>{{offer.start}}</div>\r\n              <div><b>Duration: </b>{{msToTime(offer.duration)}}</div>\r\n              <div v-if=\"offer.additionalServices.length != 0\"> <b>Additional Services: </b>\r\n                <span v-for=\"service in offer.additionalServices.slice(0,-1)\" :key=\"service\"> {{service}}, </span>\r\n                <span>{{offer.additionalServices.at(-1)}}</span>\r\n              </div>\r\n            </div>\r\n            <div class=\"offer-right\">\r\n              <button class=\"custom-btn button-primary\" @click=\"makeReservation(offer,index)\">Make a reservation</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div class=\"modal fade\" id=\"modalReservation\" tabindex=\"-1\" aria-hidden=\"true\">\r\n    <div class=\"modal-dialog\">\r\n      <div class=\"modal-content\">\r\n        <div class=\"modal-body\">\r\n          <div v-if=\"loadedCalendar\">\r\n            <v-date-picker style=\"width: 100%\" v-model=\"range\" mode='dateTime' color=\"blue\" is24hr :minute-increment=\"30\" is-range  :min-date=minDate :max-date=maxDate :attributes='attributes'>\r\n            </v-date-picker>\r\n          </div>\r\n          <div style=\"margin-top: 10px\" v-for=\"service in additionalServices\" :key=\"service\">\r\n            <span style=\"margin-right: 10px\">{{service}} </span>\r\n            <input type=\"checkbox\" v-model=\"selectedServices\" :value=\"service\" checked/>\r\n          </div>\r\n        </div>\r\n        <div class=\"modal-footer\">\r\n          <button type=\"button\" class=\"custom-btn button-primary\" id=\"close-btn\" data-bs-dismiss=\"modal\">Close</button>\r\n          <button type=\"button\" @click=\"confirmReservation\" class=\"custom-btn button-primary\" data-bs-dismiss=\"modal\">Confirm</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from \"axios\"\r\n\r\nexport default {\r\n  name: \"RentingEntityPreview\",\r\n  data(){\r\n        let takenDatesPoppers = [];\r\n    return {\r\n      id:0,\r\n      displayType:0,\r\n      rentingEntity: {},\r\n      selectedOffer: {},\r\n      selected:false,\r\n      date:null,\r\n      pictures:[],\r\n      isSubscribed:false,\r\n      index:0,     \r\n      offers: [],\r\n      additionalServices:[],\r\n      selectedServices:[],\r\n      loaded:false,\r\n      loadedCalendar:false,\r\n      takenDates:[],\r\n      range: {\r\n        start: null,\r\n        end: null,\r\n      },\r\n      incId: takenDatesPoppers.length,\r\n      takenDatesPoppers,\r\n      bars:[]\r\n    }\r\n  },\r\n  mounted(){\r\n    this.minDate=null;\r\n    this.maxDate=null;\r\n    this.displayType = this.$route.params.displayType;\r\n    this.id=this.$route.params.id;\r\n    this.loaded=false;\r\n    let path,pathOffers,pathPictures;\r\n    if(this.displayType==0 && this.id != undefined){      \r\n      path=\"/api/vacationHouses/anyUser/\"+this.id;\r\n      pathOffers=\"/api/vacationHouses/anyUser/\"+this.id+\"/offers\";\r\n      pathPictures=\"/api/vacationHouses/anyUser/\"+this.id+\"/pictures/all\";\r\n      }\r\n    else if(this.displayType==1 && this.id != undefined){\r\n      path=\"/api/ships/anyUser/\"+this.id;\r\n      pathOffers=\"/api/ships/anyUser/\"+this.id+\"/offers\";\r\n      pathPictures=\"/api/ships/anyUser/\"+this.id+\"/pictures/all\";\r\n    }\r\n    else if(this.id != undefined){\r\n      path=\"/api/fishingClasses/anyUser/\"+this.id;\r\n      pathOffers=\"/api/fishingClasses/anyUser/\"+this.id+\"/offers\";\r\n      pathPictures=\"/api/fishingClasses/anyUser/\"+this.id+\"/pictures/all\";\r\n    }\r\n\r\n    axios.get(path).then( response => {\r\n      this.rentingEntity=response.data;\r\n      this.loaded=true\r\n    });\r\n\r\n\r\n    axios.get(pathPictures).then(response => {\r\n          for (let i = 0; i < response.data.length; i++) {\r\n            this.pictures.push(response.data[i]);\r\n          }\r\n        });\r\n    axios.get(pathOffers).then(response => this.offers=response.data);\r\n\r\n    \r\n\r\n    if(localStorage.getItem(\"jwt\")!=\"null\"){\r\n      if(this.$root.loggedUser.accountType==\"CLIENT\"){\r\n        const path=\"/api/clients/isSubscribed/\"+this.id;\r\n        axios.get(path,{ headers: {\"Authorization\" : `Bearer ${localStorage.getItem(\"jwt\")}`} } ).then(response =>{\r\n        this.isSubscribed=response.data;\r\n        });\r\n      }\r\n    }\r\n\r\n},\r\ncomputed: {\r\n    attributes() {\r\n      return [\r\n        ...this.bars,       \r\n        // Attributes for todos\r\n        ...this.takenDatesPoppers.map(todo => ({\r\n          dates: todo.dates,\r\n          dot: {\r\n            color: todo.color,\r\n            class: todo.isComplete ? 'opacity-75' : '',\r\n          },\r\n          popover: {\r\n            label: todo.description,\r\n          },\r\n          customData: todo,\r\n        })),\r\n      ];\r\n    },\r\n  },\r\nmethods:{\r\n    msToTime(duration) {\r\n    var \r\n      minutes = Math.floor((duration / (1000 * 60)) % 60),\r\n      hours = Math.floor((duration / (1000 * 60 * 60)) % 24);\r\n    if(minutes>0){\r\n      return hours+\"H\" + \" \" + minutes;\r\n    }else{\r\n       return hours+\"H\";\r\n    }\r\n  },\r\n\r\n  dateFromLocal(dateString){\r\n      if(dateString==null){\r\n        return new Date();\r\n      }\r\n      \r\n      const parts=dateString.split(\" \");\r\n      \r\n      if( parts.length !=2){\r\n        return new Date();\r\n      }\r\n      const dateParts= parts[0].split(\".\");\r\n      \r\n      if( dateParts.length !=3){\r\n        return new Date();\r\n      }\r\n      const hourParts=parts[1].split(\":\");\r\n      \r\n      if( hourParts.length !=2){\r\n        return new Date();\r\n      }\r\n      \r\n      const day = dateParts[0];\r\n      const month = dateParts[1];\r\n      const year = dateParts[2];\r\n      const hours = hourParts[0];\r\n      const minutes = hourParts[1];\r\n      // new Date(year, month, day, hours, minutes, seconds, milliseconds)\r\n      const date= new Date(year,month-1,day,hours,minutes);\r\n      return date;\r\n    },\r\n  subscribe(){\r\n    if(localStorage.getItem(\"jwt\")==\"null\"){\r\n      this.$router.push(\"/loginPage\");\r\n      return;\r\n    }\r\n    if(this.$root.loggedUser.accountType!=\"CLIENT\"){\r\n      this.$toast.error(\"Only available for clients\");\r\n      return;\r\n    }\r\n    axios.put(`/api/clients/subscribe`,this.rentingEntity,{ headers: {\"Authorization\" : `Bearer ${localStorage.getItem(\"jwt\")}`} }).then(response =>{\r\n      if(response.data==true){\r\n        this.$toast.success(\"Subscribed\");\r\n        this.isSubscribed=true;\r\n      }else{\r\n        this.$toast.error(\"Error\");\r\n        this.isSubscribed=false;\r\n      }\r\n    });\r\n  },\r\n  unSubscribe(){\r\n    if(localStorage.getItem(\"jwt\")==\"null\"){\r\n      this.$router.push(\"/loginPage\");\r\n      return;\r\n    }\r\n    if(this.$root.loggedUser.accountType!=\"CLIENT\"){\r\n      this.$toast.error(\"Only available for clients\");\r\n      return;\r\n    }\r\n    axios.put(`/api/clients/unSubscribe`,this.rentingEntity,{ headers: {\"Authorization\" : `Bearer ${localStorage.getItem(\"jwt\")}`} }).then(response =>{\r\n      if(response.data==true){\r\n        this.$toast.success(\"Unsubscribed\");\r\n        this.isSubscribed=false;\r\n      }else{\r\n        this.$toast.error(\"Error\");\r\n        this.isSubscribed=true;\r\n      }\r\n    });\r\n  },\r\n  generateBar(takenDTO){\r\n    let color=\"red\";\r\n    if(takenDTO.type==\"Offer\"){\r\n      color=\"blue\";\r\n    }\r\n    let datesBars=[]\r\n    let takenTo= this.dateFromLocal(takenDTO.takenTo);\r\n    for (var d = this.dateFromLocal(takenDTO.takenFrom); d <= takenTo; d.setDate(d.getDate() + 1)) {\r\n        const date = new Date(d);\r\n        datesBars.push(date);\r\n    }\r\n    const bar={\r\n   \r\n          dates:datesBars,         \r\n          bar:color,\r\n    };\r\n    this.bars.push(bar);\r\n  },\r\n  generatePopover(takenDTO){\r\n    let color=\"red\";\r\n    if(takenDTO.type==\"Offer\"){\r\n      color=\"blue\";\r\n    }\r\n    const takenStart={\r\n        description: takenDTO.startsAt,\r\n        isComplete: false,\r\n        dates: this.dateFromLocal(takenDTO.takenFrom), // Every Friday\r\n        color: color,\r\n      };\r\n    const takenEnd={\r\n        description:  takenDTO.endsAt,\r\n        isComplete: false,\r\n        dates: this.dateFromLocal(takenDTO.takenTo), \r\n        color: color,\r\n      };\r\n    this.takenDatesPoppers.push(takenStart);\r\n    this.takenDatesPoppers.push(takenEnd);\r\n  },\r\n  takeCalendar(takenDates){\r\n    this.bars= [];\r\n    this.takenDatesPoppers=[];\r\n    takenDates.forEach(this.generateBar);\r\n    takenDates.forEach(this.generatePopover);\r\n    this.takenDates=takenDates;\r\n  },\r\n  toggleMakingReservation(){\r\n    if(localStorage.getItem(\"jwt\")==\"null\"){\r\n      this.$router.push(\"/loginPage\");\r\n      return;\r\n    }\r\n    if(this.$root.loggedUser.accountType!=\"CLIENT\"){\r\n      this.$toast.error(\"Only available for clients\");\r\n      return;\r\n    }\r\n\r\n    axios.get(`/api/clients/rentingEntityAvailability/${this.rentingEntity.id}`,{ headers: {\"Authorization\" : `Bearer ${localStorage.getItem(\"jwt\")}`} }).then(response => \r\n    {\r\n      this.takeCalendar(response.data);\r\n          const availableFromDate = this.dateFromLocal(this.rentingEntity.availableFrom);\r\n      const availableToDate = this.dateFromLocal(this.rentingEntity.availableTo);\r\n      const now = new Date();\r\n      console.log(availableFromDate);\r\n      console.log(availableToDate);\r\n\r\n    if(availableFromDate<=now){\r\n      this.minDate=now;     \r\n\r\n    }else{\r\n      this.minDate = availableFromDate;\r\n\r\n    }\r\n\r\n    if(availableToDate <= now){    \r\n      this.maxDate=now;\r\n\r\n    }else{\r\n      this.maxDate = availableToDate;\r\n\r\n    }\r\n    \r\n  \r\n\r\n    let availableFrom=\"Renting entity available from \"+this.minDate.getHours()+\":\"+this.minDate.getMinutes();\r\n    let availableTo=\"Renting entity available till \"+this.maxDate.getHours()+\":\"+this.maxDate.getMinutes();\r\n\r\n    if(availableToDate < now && availableFromDate < now){\r\n      this.$toast.error(\"Entity is not available currently\");  \r\n      availableFrom=\"Not available\";\r\n      availableTo=\"Not available\";\r\n    }\r\n    const takenStart={\r\n        description: availableFrom,\r\n        isComplete: false,\r\n        dates: this.minDate, \r\n        color: \"green\",\r\n      };\r\n    const takenEnd={\r\n         description: availableTo,\r\n        isComplete: false,\r\n        dates: this.maxDate, \r\n        color: \"green\",\r\n      };\r\n    this.takenDatesPoppers.push(takenStart);\r\n    this.takenDatesPoppers.push(takenEnd);\r\n    this.loadedCalendar=true;\r\n    });\r\n    let servicesPath;\r\n    if(this.displayType==0){\r\n      servicesPath=\"/api/vacationHouseOwners/getServices/\"+this.rentingEntity.ownerId;\r\n    }else if(this.displayType==1){\r\n      servicesPath=\"/api/shipOwners/getServices/\"+this.rentingEntity.ownerId;\r\n    }\r\n    else{\r\n      servicesPath=\"/api/fishingInstructors/getServices/\"+this.rentingEntity.ownerId;\r\n    }\r\n    axios.get(servicesPath,{ headers: {\"Authorization\" : `Bearer ${localStorage.getItem(\"jwt\")}`} }).then(response => this.additionalServices=response.data);\r\n\r\n\r\n  },\r\n  freeSlot(start,end){\r\n    for (let i = 0; i < this.takenDates.length; i++) {\r\n        const takenFrom=this.dateFromLocal(this.takenDates[i].takenFrom);\r\n        const takenTo = this.dateFromLocal(this.takenDates[i].takenTo);\r\n        if( (start>=takenFrom && end <=takenTo) || (start<=takenFrom && end >=takenTo) || (start>=takenFrom && start<=takenTo) || (end <= takenTo && end >= takenFrom) || start<this.minDate || end>this.maxDate){\r\n          return false;\r\n        } \r\n    } \r\n    return true;\r\n  },\r\n  confirmReservation(){\r\n    const start=this.range.start;\r\n    const end=this.range.end;\r\n  \r\n    if(this.freeSlot(start,end)){\r\n      \r\n\r\n      let clientLimit=0;\r\n      if(this.displayType==0){\r\n        clientLimit=this.rentingEntity.roomsQuantity*this.rentingEntity.bedsPerRoom;\r\n      }else{\r\n        clientLimit=this.rentingEntity.clientLimit;\r\n      }\r\n      if(this.$root.loggedUser.penalties==3){\r\n       this.$toast.error(\"You can not make a reservation. You have 3 penalties. Wait for next month.\");\r\n       return;\r\n      }\r\n      if(this.minDate == this.maxDate){\r\n        return;\r\n      }\r\n      const reservation={        \r\n        \"place\":this.rentingEntity.address,\r\n        \"clientLimit\": clientLimit,\r\n        \"additionalServices\":this.selectedServices,\r\n        \"price\":this.rentingEntity.priceList,\r\n        \"rentingEntityId\":this.rentingEntity.id,\r\n        \"start\":start,\r\n        \"end\":end\r\n      };\r\n      axios.post(`/api/clients/makeReservationFull`,reservation,{ headers: {\"Authorization\" : `Bearer ${localStorage.getItem(\"jwt\")}`} }).then(\r\n        response => {\r\n          if(response.data==true){\r\n            this.$toast.success(\"Reservation made\");\r\n          }else{\r\n            if(response.status == 423){\r\n                this.$toast.error(\"Try later.\");\r\n            }else{\r\n              this.$toast.error(\"Error\");\r\n            }\r\n          }\r\n        }\r\n      );\r\n    }else{\r\n      this.$toast.error(\"Select free date\");\r\n    }\r\n  },\r\n\r\n  makeReservation(offer,index){\r\n\r\n    if(localStorage.getItem(\"jwt\")==\"null\"){\r\n      this.$router.push(\"/loginPage\");\r\n      return;\r\n    }\r\n    if(this.$root.loggedUser.accountType!=\"CLIENT\"){\r\n      this.$toast.error(\"Only available for clients\");\r\n      return;\r\n    }\r\n     if(this.$root.loggedUser.penalties==3){\r\n       this.$toast.error(\"You can not make a reservation. You have 3 penalties. Wait for next month.\");\r\n       return;\r\n     }\r\n      axios.post(`/api/offers/makeQuickReservation`,offer,{ headers: {\"Authorization\" : `Bearer ${localStorage.getItem(\"jwt\")}`} }).then(response => {\r\n        if(response.data==true){\r\n           this.$toast.success(\"Reservation made\");    \r\n           this.offers.splice(index,1);\r\n        }else{\r\n          this.$toast.error(\"You can not make a reservation. You have 3 penalties. Wait for next month.\");\r\n        }\r\n      });\r\n  },\r\n  updateRating(){\r\n    this.rating=4.1;\r\n  }\r\n\r\n}\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n.inner-offer-container {\r\n  display: flex;\r\n  flex-direction: row;\r\n  flex-wrap: wrap;\r\n  justify-content: space-between;\r\n}\r\n\r\n.offer {\r\n  min-width: 100%;\r\n  padding: 10px;\r\n  border: 1px solid darkgrey;\r\n  border-radius: 5px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.offer-description {\r\n  margin: 5px;\r\n  display: flex;\r\n}\r\n\r\n.offer-left {\r\n  float: left;\r\n  width: 60%;\r\n}\r\n\r\n.offer-right {\r\n  float: right;\r\n  margin: auto;\r\n  text-align: center;\r\n  width: 40%;\r\n  overflow: hidden;\r\n}\r\n\r\n</style>"]},"metadata":{},"sourceType":"module"}